<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>WebSocket Chat en temps reel</title>
</head>

<body>
    <div class="chat-container">
        <div class="messages-container" id="messages"></div>
        <div class="message-input-container">
            <input type="text" id="messageInput" placeholder="Type a message...">
            <button id="sendButton">Send</button>
        </div>
    </div>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

    <script>
       
        //connexion au socket.io
        const socket = io("http://localhost:5000");

        // demande de username
        let username = prompt("Enter your username:");
        if (!username) {
            username = "Guest" + Math.floor(Math.random() * 1000);
        }

        // l'envoie de username au backend
        socket.emit("register", username);
        const messagesDiv = document.getElementById('messages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');

        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendButton.click();

        });

        // Recevoir un message de serveur et l'afficher
        socket.on('new message', (msg) => {
            if (msg.text && msg.text.trim() !== "")
                displayMessage(msg.username + ": " + msg.text);
            else
                displayMessage(msg, false);
        });

        //envoyer un message au serveur
        sendButton.addEventListener('click', () => {
            const message = messageInput.value.trim();
            if (message === '') return;
            socket.emit("new message", {
                username,
                text: message
            });
            displayMessage("You: " + message, true);
            messageInput.value = '';
        });

        //affichage de message dans la page 
        function displayMessage(message, isSender = false) {
            const messageContainer = document.createElement('div');
            const messageElement = document.createElement('div');
            messageElement.textContent = message;

            messageContainer.classList.add('message-container');

            if (isSender) {
                messageContainer.classList.add('sender-message-container');
                messageElement.classList.add('message-bubble', 'sender-message-bubble');
            } else {
                messageElement.classList.add('message-bubble');
            }

            messageContainer.appendChild(messageElement);
            messagesDiv.appendChild(messageContainer);

            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
    </script>
</body>

</html>